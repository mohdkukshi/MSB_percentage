<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Marks → Percentage — PDF (clean)</title>

  <!-- jsPDF (for programmatic PDF generation) and html2canvas kept only for backup if needed -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" crossorigin="anonymous"></script>

  <style>
    :root{--accent:#0f172a;--muted:#6b7280}
    *{box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
    body{margin:0;background:linear-gradient(180deg,#f1f5f9,#fff);color:var(--accent);-webkit-font-smoothing:antialiased}
    .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:28px}
    .card{width:980px;max-width:100%;border-radius:12px;padding:18px;background:rgba(255,255,255,0.95);box-shadow:0 10px 30px rgba(2,6,23,0.06);border:1px solid rgba(0,0,0,0.04)}
    h1{margin:0;font-size:20px}
    .muted{color:var(--muted);font-size:13px}
    input[type=text], input[type=number]{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.08)}
    .subjects{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:12px}
    .subject{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;background:rgba(0,0,0,0.02)}
    .actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    .btn{padding:8px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:600}
    .btn-primary{background:var(--accent);color:#fff}
    .btn-ghost{background:transparent;border:1px solid rgba(0,0,0,0.06)}
    .result{margin-top:12px;padding:12px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);background:rgba(255,255,255,0.98)}
    .small{font-size:13px;color:var(--muted)}
    @media(max-width:900px){.card{padding:12px}.subjects{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="app">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <h1>Marks → Percentage</h1>
          <div class="muted small">Name → Enter marks (≤50) → Show & Export clean PDF</div>
        </div>
      </div>

      <!-- STEP 1: Name -->
      <div id="step-name" style="margin-top:16px">
        <label class="small">1) Enter your name</label>
        <input id="studentName" type="text" placeholder="Type your name..." />
        <div class="actions" style="margin-top:10px">
          <button id="nameNext" class="btn btn-primary">Next → Enter marks</button>
        </div>
      </div>

      <!-- STEP 2: Marks -->
      <div id="step-marks" style="display:none; margin-top:16px">
        <label class="small">2) Enter marks for subjects (each ≤ 50)</label>
        <div class="subjects" id="subjectsGrid"></div>

        <div class="actions" style="margin-top:12px">
          <button id="showResult" class="btn btn-primary">Show Result</button>
          <button id="backToName" class="btn btn-ghost">Back</button>
          <button id="fillSample" class="btn btn-ghost">Fill Sample</button>
          <button id="clearMarks" class="btn btn-ghost">Clear</button>
        </div>
      </div>

      <!-- RESULT PANEL -->
      <div id="resultPanel" class="result" style="display:none">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div id="resName" style="font-weight:700">Student</div>
            <div class="small">Total: <span id="resSum">0</span> / <span id="resDenom">0</span></div>
          </div>
          <div style="text-align:right">
            <div id="resPercent" style="font-size:20px;font-weight:800">0.00%</div>
            <div class="small">Grade: <span id="resGrade">N/A</span></div>
          </div>
        </div>

        <div style="margin-top:10px" class="small">Entered marks</div>
        <div id="breakdown" style="margin-top:8px;max-height:220px;overflow:auto"></div>

        <div style="margin-top:12px;display:flex;gap:8px">
          <button id="exportPdf" class="btn btn-primary">Export PDF (clean)</button>
          <button id="downloadCSV" class="btn btn-ghost">Download CSV</button>
          <button id="startOver" class="btn btn-ghost">Start Over</button>
        </div>
      </div>

    </div>
  </div>

<script>
/* Simple app with programmatic PDF generation (only name, overall percentage, entered subjects) */

const SUBJECTS = ['Literature','Language','Marathi','Hindi','Maths','Physics','Chemistry','Biology','History','Geography'];
const MAX_PER = 50;

function $(id){ return document.getElementById(id); }
function clamp(n,a,b){ return Math.max(a, Math.min(b, n)); }
function calcGrade(p){
  if (p>=90) return 'A+';
  if (p>=80) return 'A';
  if (p>=70) return 'B+';
  if (p>=60) return 'B';
  if (p>=50) return 'C';
  return 'D / Needs improvement';
}

let state = { subjects: SUBJECTS.map(s => ({ name: s, marks: '' })) };

// Render subject inputs
function renderSubjects(){
  const grid = $('subjectsGrid');
  grid.innerHTML = '';
  state.subjects.forEach((s, idx) => {
    const div = document.createElement('div');
    div.className = 'subject';
    div.innerHTML = `
      <div style="min-width:0">
        <div style="font-weight:600">${s.name}</div>
        <div class="small" style="font-size:12px">0 — ${MAX_PER}</div>
      </div>
      <div><input data-idx="${idx}" type="number" min="0" max="${MAX_PER}" value="${s.marks}" style="width:86px;padding:6px;border-radius:6px;border:1px solid rgba(0,0,0,0.06);text-align:center" /></div>
    `;
    grid.appendChild(div);
  });

  grid.querySelectorAll('input[type=number]').forEach(inp => {
    inp.addEventListener('input', (e) => {
      const i = Number(inp.dataset.idx);
      let v = e.target.value;
      if (v === '') { state.subjects[i].marks = ''; }
      else {
        v = clamp(Number(v) || 0, 0, MAX_PER);
        state.subjects[i].marks = v;
        e.target.value = v;
      }
    });
  });
}

// Steps & handlers
$('nameNext').addEventListener('click', () => {
  const name = $('studentName').value.trim();
  if (!name){ alert('Please enter your name'); $('studentName').focus(); return; }
  $('step-name').style.display = 'none';
  $('step-marks').style.display = 'block';
  renderSubjects();
});

$('backToName').addEventListener('click', () => {
  $('step-marks').style.display = 'none';
  $('step-name').style.display = 'block';
  $('resultPanel').style.display = 'none';
});

$('fillSample').addEventListener('click', () => {
  const sample = { Literature:23, Language:18, Marathi:22, Hindi:34, Maths:19, Physics:18, Chemistry:21, Biology:13, History:27, Geography:26 };
  state.subjects = SUBJECTS.map(s => ({ name:s, marks: sample[s] ?? '' }));
  renderSubjects();
});

$('clearMarks').addEventListener('click', () => {
  state.subjects = SUBJECTS.map(s => ({ name:s, marks: '' }));
  renderSubjects();
});

// compute & display result
function showResult(){
  const name = $('studentName').value.trim();
  if (!name){ alert('Enter your name'); $('studentName').focus(); return; }

  // ensure latest values pulled from inputs
  document.querySelectorAll('#subjectsGrid input[type=number]').forEach(inp => {
    const i = Number(inp.dataset.idx);
    const v = inp.value;
    state.subjects[i].marks = (v === '') ? '' : clamp(Number(v)||0, 0, MAX_PER);
  });

  const entered = state.subjects.filter(s => s.marks !== '' && s.marks !== null && s.marks !== undefined);
  const sum = entered.reduce((a,b) => a + Number(b.marks), 0);
  const denom = SUBJECTS.length * MAX_PER;
  const percentage = denom === 0 ? 0 : (sum / denom) * 100;
  const grade = calcGrade(percentage);

  $('resName').textContent = name;
  $('resSum').textContent = sum;
  $('resDenom').textContent = denom;
  $('resPercent').textContent = percentage.toFixed(2) + '%';
  $('resGrade').textContent = grade;

  const bd = $('breakdown'); bd.innerHTML = '';
  if (entered.length === 0) bd.innerHTML = '<div class="small">No marks entered yet.</div>';
  entered.forEach(s => {
    const row = document.createElement('div');
    row.style.display='flex'; row.style.justifyContent='space-between'; row.style.padding='6px 0';
    row.innerHTML = `<div class="small">${s.name}</div><div style="font-weight:600">${s.marks}</div>`;
    bd.appendChild(row);
  });

  $('resultPanel').style.display = 'block';
  $('resultPanel').scrollIntoView({ behavior:'smooth', block:'center' });
}

$('showResult').addEventListener('click', showResult);

// Programmatic PDF — only Name, Overall Percentage, Subjects with marks entered
function exportCleanPDF(){
  // gather data
  const name = $('studentName').value.trim() || 'Student';
  const entered = state.subjects.filter(s => s.marks !== '' && s.marks !== null && s.marks !== undefined);
  const sum = entered.reduce((a,b)=>a+Number(b.marks),0);
  const denom = SUBJECTS.length * MAX_PER;
  const percentage = denom === 0 ? 0 : (sum/denom)*100;

  // Use jsPDF to draw text
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF({ unit: 'pt', format: 'a4' });
  const left = 40;
  let y = 60;
  const lineHeight = 16;
  pdf.setFontSize(16);
  pdf.text('Marks Report', left, y);
  y += 24;
  pdf.setFontSize(12);
  pdf.text(`Name: ${name}`, left, y);
  y += lineHeight + 4;
  pdf.text(`Overall Percentage: ${percentage.toFixed(2)}%`, left, y);
  y += lineHeight + 8;

  // Add a small separator
  pdf.setLineWidth(0.5);
  pdf.line(left, y, pdf.internal.pageSize.getWidth() - left, y);
  y += 12;

  // Table header
  pdf.setFontSize(12);
  pdf.text('Subject', left, y);
  pdf.text('Marks', pdf.internal.pageSize.getWidth() - left - 40, y);
  y += lineHeight;

  // If no entered marks show a note
  if (entered.length === 0){
    pdf.setFontSize(11);
    pdf.text('(No marks entered)', left, y);
    y += lineHeight;
  } else {
    pdf.setFontSize(11);
    for (let i=0;i<entered.length;i++){
      const s = entered[i];
      // if running out of page, add new page
      if (y > pdf.internal.pageSize.getHeight() - 60){
        pdf.addPage();
        y = 60;
      }
      pdf.text(s.name, left, y);
      pdf.text(String(s.marks), pdf.internal.pageSize.getWidth() - left - 40, y);
      y += lineHeight;
    }
  }

  // Save file (filename includes name)
  const filename = (name.replace(/\s+/g,'_') || 'student') + '_marks_report.pdf';
  pdf.save(filename);
}

$('exportPdf').addEventListener('click', () => {
  // make sure we have latest state before export
  document.querySelectorAll('#subjectsGrid input[type=number]').forEach(inp => {
    const i = Number(inp.dataset.idx);
    const v = inp.value;
    state.subjects[i].marks = (v === '') ? '' : clamp(Number(v)||0, 0, MAX_PER);
  });
  exportCleanPDF();
});

// CSV (optional)
function downloadCSV(){
  const rows = [['Subject','Marks']];
  state.subjects.forEach(s => rows.push([s.name, s.marks === '' ? '' : String(s.marks)]));
  const csv = rows.map(r => r.map(c => `"${String(c).replace(/"/g,'""')}"`).join(',')).join('\\n');
  const blob = new Blob([csv], { type:'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = ($('studentName').value.trim() || 'student') + '_marks.csv';
  document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
}
$('downloadCSV').addEventListener('click', downloadCSV);

$('startOver').addEventListener('click', () => {
  $('resultPanel').style.display = 'none';
  $('step-marks').style.display = 'block';
  $('step-name').style.display = 'none';
  state.subjects = SUBJECTS.map(s => ({ name:s, marks: '' }));
  renderSubjects();
});

renderSubjects();
</script>
</body>
</html>
